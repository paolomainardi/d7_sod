(function(a,b,c){function l(b){var c=a(b.target);f.clearState(),f.touches.start=d.getTouches(b),f.events.start=b,f.timestamp=(new Date).getTime(),f.events.start=b,f.offset=c.offset(),g.exec("start",b)}function m(a){if(!f.timestamp)return;f.touches.move=d.getTouches(a),f.events.move=a,g.exec("move",a)}function n(a){if(!f.timestamp)return;f.touches.end=d.getTouches(a),f.events.end=a,g.exec("end",a),f.prevGesture=f.gesture,f.clearState()}function o(b,c,d){var e=a(this),f=e.data("toe")||0;f===0&&(e.on("touchstart",i),e.on("touchmove",j),e.on("touchend touchcancel",k)),e.data("toe",++f)}function p(b){var c=a(this),d=c.data("toe")||0;c.data("toe",--d),d===0&&(c.off("touchstart",i),c.off("touchmove",j),c.off("touchend touchcancel",k))}function q(b){h&&(a.event.special[b]={setup:o,teardown:p})}var d={};d.getTouches=function(b){return b.originalEvent.touches.length>0?a.extend(!0,{},b.originalEvent.touches):b.originalEvent.changedTouches.length>0?a.extend(!0,{},b.originalEvent.changedTouches):[]},d.hasEvent=function(a,b){return a.data("events")?a.data("events")[b]:0};var e={};e.getDirection=function(a){if(a<-45&&a>-135)return"top";if(a>=-45&&a<=45)return"right";if(a>=45&&a<135)return"down";if(a>=135||a<=-135)return"left"},e.getAngle=function(a,b){return Math.atan2(b.pageY-a.pageY,b.pageX-a.pageX)*180/Math.PI},e.getScale=function(a,b){return a.length===2&&b.length===2?Math.sqrt(Math.pow(b[0].pageX-b[1].pageX,2)+Math.pow(b[0].pageY-b[1].pageY,2))/Math.sqrt(Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)):0},e.getRotation=function(a,b){return a.length===2&&b.length===2?Math.atan2(b[0].pageY-b[1].pageY,b[0].pageX-b[1].pageX)*180/Math.PI-Math.atan2(a[0].pageY-a[1].pageY,a[0].pageX-a[1].pageX)*180/Math.PI:0},e.getDistance=function(a,b){return Math.sqrt(Math.pow(b.pageX-a.pageX,2)+Math.pow(b.pageY-a.pageY,2))};var f={touches:{},events:{},timestamp:c,prevGesture:null,offset:{}};f.clearState=function(){f.touches={},f.events={},f.timestamp=c};var g={start:[],move:[],end:[],none:[]};g.add=function(a,b,d,e){var f,h,i=!1;if(e)for(f=0;f<g[a].length;f++){h=g[a][f];if(h.priority&&h.priority<e)continue;g[a].splice(f,0,{gesture:b,func:d,priority:c}),i=!0}(!e||!i)&&g[a].push({gesture:b,func:d,priority:c}),q(b)},g.exec=function(a,b){var c;for(c=0;c<g[a].length;c++)g[a][c].func(b)};var h="ontouchstart"in b,i,j,k;i=a.proxy(l,this),j=a.proxy(m,this),k=a.proxy(n,this),function(b,c,d){function f(b){var f=(new Date).getTime()-c.timestamp,g,h,i;if(!c.touches.move)return;i=d.getDistance(c.touches.start[0],c.touches.move[0]),e.swipe_time>f&&i>e.swipe_min_distance&&(g=d.getAngle(c.touches.start[0],c.touches.move[0]),h=d.getDirection(g),c.gesture="swipe",a(b.target).trigger(a.Event("swipe",{originalEvent:b.originalEvent,direction:h})))}var e={swipe_time:300,swipe_min_distance:30};b.add("end","swipe",f)}(g,f,e),function(b,c,d,e){function k(b){var j=(new Date).getTime(),k=j-c.timestamp,m=a(b.target);if(f.hold_timeout<k)return;b=c.events.start.originalEvent,l(b)||(g=c.touches.move?d.getDistance(c.touches.start[0],c.touches.move[0]):0,g<f.tap_max_distance&&(c.gesture="tap",i=j,h=c.touches.start,e.hasEvent(m,"doubletap")?setTimeout(function(){h&&c.prevGesture!=="doubletap"&&(new Date).getTime()-i>f.tap_double_max_interval&&m.trigger(a.Event("tap",{originalEvent:b}))},f.tap_double_max_interval):m.trigger(a.Event("tap",{originalEvent:b}))))}function l(b){return h&&c.prevGesture==="tap"&&c.timestamp-i<f.tap_double_max_interval&&h&&c.touches.start&&d.getDistance(h[0],c.touches.start[0])<f.tap_distance?(c.gesture="doubletap",i=null,a(b.target).trigger(a.Event("doubletap",{originalEvent:b})),!0):!1}function m(b){c.gesture="taphold",clearTimeout(j),j=setTimeout(function(){c.touches.start&&!c.touches.end&&(g=c.touches.move?d.getDistance(c.touches.start[0],c.touches.move[0]):0,g<f.tap_max_distance&&c.gesture==="taphold"&&a(b.target).trigger(a.Event("taphold",{originalEvent:c.events.start?c.events.start.originalEvent:b.originalEvent})))},f.hold_timeout)}var f={tap_double_max_interval:300,tap_max_distance:10,tap_distance:20,hold_timeout:500},g,h,i,j;b.add("end","tap",k),b.add("none","doubletap",a.noop),b.add("start","taphold",m)}(g,f,e,d),function(b,c,d){function h(b){var h,i,j=a(b.target);if(c.touches.move.length!==2)return;h=d.getRotation(c.touches.start,c.touches.move),i=d.getScale(c.touches.start,c.touches.move);if(c.gesture==="transform"||Math.abs(1-i)>e.scale_treshold||Math.abs(h)>e.rotation_treshold)c.gesture="transform",g={pageX:(c.touches.move[0].pageX+c.touches.move[1].pageX)/2-c.offset.left,pageY:(c.touches.move[0].pageY+c.touches.move[1].pageY)/2-c.offset.top},f||(j.trigger(a.Event("transformstart",{originalEvent:b.originalEvent,center:g,scale:i,rotation:h})),f=!0),j.trigger(a.Event("transform",{originalEvent:b.originalEvent,center:g,scale:i,rotation:h}))}function i(b){var e,h,i=a(b.target);c.gesture==="transform"&&(e=d.getRotation(c.touches.start,c.touches.move),h=d.getScale(c.touches.start,c.touches.move),i.trigger(a.Event("transformend",{originalEvent:b.originalEvent,center:g,scale:h,rotation:e})),f=!1)}var e={scale_treshold:.1,rotation_treshold:15},f=!1,g;b.add("move","transform",h),b.add("end","transformend",i)}(g,f,e)})(jQuery,window);